Œä
CC:\Users\VishnuPadiga\Desktop\EventManager\Services\EventService.cs
	namespace 	
Services
 
{ 
public 
class	 
EventService 
: 
IEventService +
{ 
private 
readonly 
IEventRepository %
_eventRepository& 6
;6 7
private 
readonly 
IUserService !
_userService" .
;. /
private 
readonly 
IUserRepository $
_userRepository% 4
;4 5
private 
readonly 
IMapper 
_mapper $
;$ %
private 
static 
readonly 
Logger "
_logger# *
=+ ,

LogManager- 7
.7 8!
GetCurrentClassLogger8 M
(M N
)N O
;O P
public 

EventService 
( 
IEventRepository (
eventRepository) 8
,8 9
IUserService: F
userServiceG R
,R S
IUserRepository '
userRepository( 6
,6 7
IMapper8 ?
mapper@ F
)F G
{ 
_eventRepository 
= 
eventRepository (
;( )
_userService 
= 
userService  
;  !
_mapper 
= 
mapper 
; 
_userRepository 
= 
userRepository &
;& '
} 
public%% 

IdDto%% 
CreateEvent%% 
(%% 
EventDto%% %
eventDto%%& .
)%%. /
{&& 
_logger'' 
.'' 
Info'' 
('' 
$str'' E
,''E F
eventDto''G O
)''O P
;''P Q
if(( 
(((	 

eventDto((
 
.(( 
StartDateTime((  
>=((! #
eventDto(($ ,
.((, -
EndDateTime((- 8
)((8 9
{)) 
_logger** 
.** 
Error** 
(** 
$str** Q
)**Q R
;**R S
throw++ 
new++ 
CustomException++ !
(++! "
$num++" %
,++% &
$str++' 4
,++4 5
$str++6 b
)++b c
;++c d
},, 
else-- 

if-- 
(-- 
DateTime-- 
.-- 
Now-- 
>-- 
eventDto-- &
.--& '
StartDateTime--' 4
)--4 5
{.. 
_logger// 
.// 
Error// 
(// 
$str// R
)//R S
;//S T
throw00 
new00 
CustomException00 !
(00! "
$num00" %
,00% &
$str00' 4
,004 5
$str006 W
)00W X
;00X Y
}11 
_logger22 
.22 
Debug22 
(22 
$str22 :
,22: ;
eventDto22< D
)22D E
;22E F

EventModel33 

eventModel33 
=33 
_mapper33 %
.33% &
Map33& )
<33) *

EventModel33* 4
>334 5
(335 6
eventDto336 >
)33> ?
;33? @
_logger44 
.44 
Debug44 
(44 
$str44 ;
,44; <

eventModel44= G
)44G H
;44H I
bool55 

createdEvent55 
=55 
_eventRepository55 *
.55* +
CreateEvent55+ 6
(556 7

eventModel557 A
)55A B
;55B C
if66 
(66	 

createdEvent66
 
==66 
false66 
)66  
{77 
_logger88 
.88 
Error88 
(88 
$str88 K
)88K L
;88L M
throw99 
new99 
CustomException99 !
(99! "
$num99" %
,99% &
$str99' >
,99> ?
$str99@ V
)99V W
;99W X
}:: 
_logger;; 
.;; 
Info;; 
(;; 
$str;; ;
,;;; <

eventModel;;= G
.;;G H
Id;;H J
);;J K
;;;K L
return<< 
new<< 
IdDto<< 
(<< 
)<< 
{== 
Id>> 

=>> 

eventModel>> 
.>> 
Id>> 
}?? 
;?? 
}@@ 
publicII 

ListII 
<II 

EventIdDtoII 
>II 
	GetEventsII %
(II% &
stringII& ,
eventKeyII- 5
,II5 6
intII7 :

startIndexII; E
,IIE F
intIIG J
rowSizeIIK R
)IIR S
{JJ 
_loggerKK 
.KK 
InfoKK 
(KK 
$strKK 3
,KK3 4
eventKeyKK5 =
)KK= >
;KK> ?
ifLL 
(LL	 

eventKeyLL
 
.LL 
ToLowerLL 
(LL 
)LL 
==LL 
$strLL  %
)LL% &
{MM 
ListNN 
<NN 

EventModelNN 
>NN 
eventModelsNN $
=NN% &
_eventRepositoryNN' 7
.NN7 8
GetAllEventsNN8 D
(NND E

startIndexNNE O
,NNO P
rowSizeNNQ X
)NNX Y
;NNY Z
ListOO 
<OO 

EventIdDtoOO 
>OO 
eventsOO 
=OO  !
_mapperOO" )
.OO) *
MapOO* -
<OO- .
ListOO. 2
<OO2 3

EventIdDtoOO3 =
>OO= >
>OO> ?
(OO? @
eventModelsOO@ K
)OOK L
;OOL M
_loggerPP 
.PP 
InfoPP 
(PP 
$strPP O
,PPO P
eventKeyPPQ Y
,PPY Z
eventsPP[ a
)PPa b
;PPb c
returnQQ 
eventsQQ 
;QQ 
}RR 
elseSS 

ifSS 
(SS 
eventKeySS 
.SS 
ToLowerSS 
(SS  
)SS  !
==SS" $
$strSS% +
)SS+ ,
{TT 
ListUU 
<UU 

EventModelUU 
>UU 
eventModelsUU $
=UU% &
_eventRepositoryUU' 7
.UU7 8
GetPastEventsUU8 E
(UUE F

startIndexUUF P
,UUP Q
rowSizeUUR Y
)UUY Z
;UUZ [
ListVV 
<VV 

EventIdDtoVV 
>VV 
eventsVV 
=VV  !
_mapperVV" )
.VV) *
MapVV* -
<VV- .
ListVV. 2
<VV2 3

EventIdDtoVV3 =
>VV= >
>VV> ?
(VV? @
eventModelsVV@ K
)VVK L
;VVL M
_loggerWW 
.WW 
InfoWW 
(WW 
$strWW P
,WWP Q
eventKeyWWR Z
,WWZ [
eventsWW\ b
)WWb c
;WWc d
returnXX 
eventsXX 
;XX 
}YY 
elseZZ 

ifZZ 
(ZZ 
eventKeyZZ 
.ZZ 
ToLowerZZ 
(ZZ  
)ZZ  !
==ZZ" $
$strZZ% /
)ZZ/ 0
{[[ 
List\\ 
<\\ 

EventModel\\ 
>\\ 
eventModels\\ $
=\\% &
_eventRepository\\' 7
.\\7 8
GetUpComingEvents\\8 I
(\\I J

startIndex\\J T
,\\T U
rowSize\\V ]
)\\] ^
;\\^ _
List]] 
<]] 

EventIdDto]] 
>]] 
events]] 
=]]  !
_mapper]]" )
.]]) *
Map]]* -
<]]- .
List]]. 2
<]]2 3

EventIdDto]]3 =
>]]= >
>]]> ?
(]]? @
eventModels]]@ K
)]]K L
;]]L M
_logger^^ 
.^^ 
Info^^ 
(^^ 
$str^^ P
,^^P Q
eventKey^^R Z
,^^Z [
events^^\ b
)^^b c
;^^c d
return__ 
events__ 
;__ 
}`` 
elseaa 

{bb 
_loggercc 
.cc 
Errorcc 
(cc 
$strcc 6
,cc6 7
eventKeycc8 @
)cc@ A
;ccA B
throwdd 
newdd 
CustomExceptiondd !
(dd! "
$numdd" %
,dd% &
$strdd' 4
,dd4 5
$strdd6 I
)ddI J
;ddJ K
}ee 
}ff 
publicnn 

Listnn 
<nn 
UserDtonn 
>nn 
CreateAttendeenn '
(nn' (
Guidnn( ,
eventIdnn- 4
,nn4 5
	IFormFilenn6 ?
filenn@ D
)nnD E
{oo 
_loggerpp 
.pp 
Infopp 
(pp 
$strpp <
,pp< =
filepp> B
,ppB C
eventIdppD K
)ppK L
;ppL M
_loggerrr 
.rr 
Debugrr 
(rr 
$strrr 6
,rr6 7
eventIdrr8 ?
)rr? @
;rr@ A

EventModelss 
?ss 

eventModelss 
=ss 
_eventRepositoryss /
.ss/ 0
GetEventByIdss0 <
(ss< =
eventIdss= D
)ssD E
;ssE F
iftt 
(tt	 


eventModeltt
 
==tt 
nulltt 
||tt 

eventModeltt  *
.tt* +
IsActivett+ 3
==tt4 6
falsett7 <
||tt= ?

eventModeltt@ J
.ttJ K
StartDateTimettK X
<ttY Z
DateTimett[ c
.ttc d
Nowttd g
||tth j

eventModelttk u
.ttu v
EndDateTime	ttv Å
<
ttÇ É
DateTime
ttÑ å
.
ttå ç
Now
ttç ê
)
ttê ë
{uu 
_loggervv 
.vv 
Errorvv 
(vv 
$strvv 6
,vv6 7
eventIdvv8 ?
)vv? @
;vv@ A
throwww 
newww 
CustomExceptionww !
(ww! "
$numww" %
,ww% &
$strww' 2
,ww2 3
$strww4 E
)wwE F
;wwF G
}xx 
_userServicezz 
.zz 

UploadUserzz 
(zz 
filezz "
)zz" #
;zz# $
using|| 
(|| 
var|| 
reader|| 
=|| 
new|| 
StreamReader|| *
(||* +
file||+ /
.||/ 0
OpenReadStream||0 >
(||> ?
)||? @
)||@ A
)||A B
using}} 
(}} 
var}} 
csv}} 
=}} 
new}} 
	CsvReader}} $
(}}$ %
reader}}% +
,}}+ ,
CultureInfo}}- 8
.}}8 9
InvariantCulture}}9 I
)}}I J
)}}J K
{~~ 
_logger 
. 
Debug 
( 
$str 9
)9 :
;: ;
List
ÄÄ 
<
ÄÄ 
UserDto
ÄÄ 
>
ÄÄ 
users
ÄÄ 
=
ÄÄ 
csv
ÄÄ !
.
ÄÄ! "

GetRecords
ÄÄ" ,
<
ÄÄ, -
UserDto
ÄÄ- 4
>
ÄÄ4 5
(
ÄÄ5 6
)
ÄÄ6 7
.
ÄÄ7 8
ToList
ÄÄ8 >
(
ÄÄ> ?
)
ÄÄ? @
;
ÄÄ@ A
_logger
ÇÇ 
.
ÇÇ 
Debug
ÇÇ 
(
ÇÇ 
$str
ÇÇ L
)
ÇÇL M
;
ÇÇM N
List
ÉÉ 
<
ÉÉ 
UserDto
ÉÉ 
>
ÉÉ 
conflictedUsers
ÉÉ %
=
ÉÉ& ' 
GetConflictedUsers
ÉÉ( :
(
ÉÉ: ;

eventModel
ÉÉ; E
.
ÉÉE F
StartDateTime
ÉÉF S
,
ÉÉS T

eventModel
ÉÉU _
.
ÉÉ_ `
EndDateTime
ÉÉ` k
,
ÉÉk l
users
ÉÉm r
)
ÉÉr s
;
ÉÉs t
users
ÖÖ 
=
ÖÖ 
users
ÖÖ 
.
ÖÖ 
Except
ÖÖ 
(
ÖÖ 
conflictedUsers
ÖÖ ,
)
ÖÖ, -
.
ÖÖ- .
ToList
ÖÖ. 4
(
ÖÖ4 5
)
ÖÖ5 6
;
ÖÖ6 7
List
áá 
<
áá  
EventAttendeeModel
áá 
>
áá  
eventAttendees
áá! /
=
áá0 1
_mapper
áá2 9
.
áá9 :
Map
áá: =
<
áá= >
List
áá> B
<
ááB C 
EventAttendeeModel
ááC U
>
ááU V
>
ááV W
(
ááW X
users
ááX ]
.
áá] ^
Select
áá^ d
(
áád e
x
ááe f
=>
áág i
x
ááj k
.
áák l
UserId
áál r
)
áár s
.
áás t
ToList
áát z
(
ááz {
)
áá{ |
)
áá| }
;
áá} ~
eventAttendees
àà 
.
àà 
ForEach
àà 
(
àà 
x
àà  
=>
àà! #
x
àà$ %
.
àà% &
EventId
àà& -
=
àà. /
eventId
àà0 7
)
àà7 8
;
àà8 9
_logger
ää 
.
ää 
Debug
ää 
(
ää 
$str
ää W
,
ääW X
eventAttendees
ääY g
)
ääg h
;
ääh i
_eventRepository
ãã 
.
ãã 
CreateAttendee
ãã '
(
ãã' (
eventAttendees
ãã( 6
)
ãã6 7
;
ãã7 8
_logger
çç 
.
çç 
Info
çç 
(
çç 
$str
çç E
,
ççE F
file
ççG K
,
ççK L
eventId
ççM T
)
ççT U
;
ççU V
return
èè 
conflictedUsers
èè 
;
èè 
}
êê 
}
ëë 
public
òò 

List
òò 
<
òò 
UserDto
òò 
>
òò 
GetUsersForEvent
òò )
(
òò) *
Guid
òò* .
eventId
òò/ 6
)
òò6 7
{
ôô 
_logger
öö 
.
öö 
Info
öö 
(
öö 
$str
öö C
,
ööC D
eventId
ööE L
)
ööL M
;
ööM N

EventModel
úú 
?
úú 

eventModel
úú 
=
úú 
_eventRepository
úú /
.
úú/ 0
GetEventById
úú0 <
(
úú< =
eventId
úú= D
)
úúD E
;
úúE F
if
ùù 
(
ùù	 


eventModel
ùù
 
==
ùù 
null
ùù 
)
ùù 
{
ûû 
_logger
üü 
.
üü 
Error
üü 
(
üü 
$str
üü 6
,
üü6 7
eventId
üü8 ?
)
üü? @
;
üü@ A
throw
†† 
new
†† 
CustomException
†† !
(
††! "
$num
††" %
,
††% &
$str
††' 2
,
††2 3
$str
††4 E
)
††E F
;
††F G
}
°° 
List
££ 

<
££
 
UserDto
££ 
>
££ 
users
££ 
=
££ 
_userRepository
££ +
.
££+ ,
GetUsersForEvent
££, <
(
££< =
eventId
££= D
)
££D E
;
££E F
_logger
•• 
.
•• 
Info
•• 
(
•• 
$str
•• Q
,
••Q R
eventId
••S Z
)
••Z [
;
••[ \
return
¶¶ 
users
¶¶ 
;
¶¶ 
}
ßß 
public
©© 

List
©© 
<
©© 
UserDto
©© 
>
©©  
GetConflictedUsers
©© +
(
©©+ ,
DateTime
©©, 4
startDateTime
©©5 B
,
©©B C
DateTime
©©D L
endDateTime
©©M X
,
©©X Y
List
©©Z ^
<
©©^ _
UserDto
©©_ f
>
©©f g
users
©©h m
)
©©m n
{
™™ 
_logger
´´ 
.
´´ 
Info
´´ 
(
´´ 
$str
´´ S
,
´´S T
startDateTime
´´U b
,
´´b c
endDateTime
´´d o
)
´´o p
;
´´p q
List
≠≠ 

<
≠≠
 
UserDto
≠≠ 
>
≠≠  
allConflictedUsers
≠≠ &
=
≠≠' (
_eventRepository
≠≠) 9
.
≠≠9 : 
GetConflictedUsers
≠≠: L
(
≠≠L M
startDateTime
≠≠M Z
,
≠≠Z [
endDateTime
≠≠\ g
,
≠≠g h
users
≠≠i n
)
≠≠n o
;
≠≠o p
var
ØØ 	
conflictedUsers
ØØ
 
=
ØØ 
from
ØØ  
user1
ØØ! &
in
ØØ' )
users
ØØ* /
join
∞∞  
user2
∞∞! &
in
∞∞' ) 
allConflictedUsers
∞∞* <
on
±± 
new
±± "
{
±±# $
user1
±±% *
.
±±* +
UserId
±±+ 1
,
±±1 2
user1
±±3 8
.
±±8 9
UserName
±±9 A
}
±±B C
equals
±±D J
new
±±K N
{
±±O P
user2
±±Q V
.
±±V W
UserId
±±W ]
,
±±] ^
user2
±±_ d
.
±±d e
UserName
±±e m
}
±±n o
select
≤≤ "
user1
≤≤# (
;
≤≤( )
_logger
¥¥ 
.
¥¥ 
Info
¥¥ 
(
¥¥ 
$str
¥¥ H
,
¥¥H I
conflictedUsers
¥¥J Y
,
¥¥Y Z
users
¥¥[ `
)
¥¥` a
;
¥¥a b
return
µµ 
conflictedUsers
µµ 
.
µµ 
ToList
µµ #
(
µµ# $
)
µµ$ %
;
µµ% &
}
∂∂ 
}
∑∑ 
}∏∏ «<
BC:\Users\VishnuPadiga\Desktop\EventManager\Services\UserService.cs
	namespace 	
Services
 
{ 
public 
class	 
UserService 
: 
IUserService )
{ 
private 
readonly 
IUserRepository $
_userRepository% 4
;4 5
private 
static 
readonly 
Logger "
_logger# *
=+ ,

LogManager- 7
.7 8!
GetCurrentClassLogger8 M
(M N
)N O
;O P
private 
readonly 
IEventRepository %
_eventRepository& 6
;6 7
private 
readonly 
IMapper 
_mapper $
;$ %
public 

UserService 
( 
IUserRepository &
userRepository' 5
,5 6
IEventRepository7 G
eventRepositoryH W
,W X
IMapperY `
mappera g
)g h
{ 
_userRepository 
= 
userRepository &
;& '
_mapper 
= 
mapper 
; 
_eventRepository 
= 
eventRepository (
;( )
} 
public   

bool   

UploadUser   
(   
	IFormFile   $
file  % )
)  ) *
{!! 
_logger"" 
."" 
Info"" 
("" 
$str"" E
,""E F
file""G K
)""K L
;""L M
try## 	
{$$ 
_logger%% 
.%% 
Debug%% 
(%% 
$str%% ?
,%%? @
file%%A E
)%%E F
;%%F G
using'' 
('' 
var'' 
reader'' 
='' 
new'' 
StreamReader''  ,
('', -
file''- 1
.''1 2
OpenReadStream''2 @
(''@ A
)''A B
)''B C
)''C D
using(( 
((( 
var(( 
csv(( 
=(( 
new(( 
	CsvReader(( &
(((& '
reader((' -
,((- .
CultureInfo((/ :
.((: ;
InvariantCulture((; K
)((K L
)((L M
{)) 	
var**
 
users** 
=** 
csv** 
.** 

GetRecords** $
<**$ %
	UserModel**% .
>**. /
(**/ 0
)**0 1
.**1 2
ToList**2 8
(**8 9
)**9 :
;**: ;
_logger++
 
.++ 
Debug++ 
(++ 
$str++ 8
,++8 9
users++: ?
)++? @
;++@ A
bool,,
 
upload,, 
=,, 
_userRepository,, '
.,,' (

UploadUser,,( 2
(,,2 3
users,,3 8
),,8 9
;,,9 :
_logger--
 
.-- 
Info-- 
(-- 
$str-- @
,--@ A
users--B G
)--G H
;--H I
return..
 
true.. 
;.. 
}// 	
}00 
catch11 
{22 
_logger33 
.33 
Error33 
(33 
$str33 4
)334 5
;335 6
throw44 
new44 
CustomException44 !
(44! "
$num44" %
,44% &
$str44' 4
,444 5
$str446 O
)44O P
;44P Q
}55 
}66 
public>> 

List>> 
<>> 
UserDto>> 
>>> 
GetAllUsers>> $
(>>$ %
int>>% (

startIndex>>) 3
,>>3 4
int>>5 8
rowSize>>9 @
)>>@ A
{?? 
List@@ 

<@@
 
	UserModel@@ 
>@@ 

userModels@@  
=@@! "
_userRepository@@# 2
.@@2 3
GetAllUsers@@3 >
(@@> ?

startIndex@@? I
,@@I J
rowSize@@K R
)@@R S
;@@S T
ListAA 

<AA
 
UserDtoAA 
>AA 
userDtoListAA 
=AA  !
_mapperAA" )
.AA) *
MapAA* -
<AA- .
ListAA. 2
<AA2 3
UserDtoAA3 :
>AA: ;
>AA; <
(AA< =

userModelsAA= G
)AAG H
;AAH I
returnBB 
userDtoListBB 
;BB 
}CC 
publicJJ 

UserDtoJJ 
GetUserByIdJJ 
(JJ 
intJJ "
userIdJJ# )
)JJ) *
{KK 
_loggerLL 
.LL 
InfoLL 
(LL 
$strLL 8
,LL8 9
userIdLL: @
)LL@ A
;LLA B
	UserModelNN 
?NN 
	userModelNN 
=NN 
_userRepositoryNN ,
.NN, -
GetUserByIdNN- 8
(NN8 9
userIdNN9 ?
)NN? @
;NN@ A
ifOO 
(OO	 

	userModelOO
 
==OO 
nullOO 
)OO 
{PP 
_loggerQQ 
.QQ 
ErrorQQ 
(QQ 
$strQQ ;
,QQ; <
userIdQQ= C
)QQC D
;QQD E
throwRR 
newRR 
CustomExceptionRR !
(RR! "
$numRR" %
,RR% &
$strRR' 2
,RR2 3
$strRR4 D
)RRD E
;RRE F
}SS 
_loggerTT 
.TT 
DebugTT 
(TT 
$strTT @
,TT@ A
	userModelTTB K
)TTK L
;TTL M
UserDtoVV 
userVV 
=VV 
_mapperVV 
.VV 
MapVV  
<VV  !
UserDtoVV! (
>VV( )
(VV) *
	userModelVV* 3
)VV3 4
;VV4 5
_loggerXX 
.XX 
InfoXX 
(XX 
$strXX J
,XXJ K
userXXL P
,XXP Q
userIdXXR X
)XXX Y
;XXY Z
returnZZ 
userZZ 
;ZZ 
}[[ 
publicbb 

Listbb 
<bb 

EventIdDtobb 
>bb 
GetEventsForUserbb ,
(bb, -
intbb- 0
userIdbb1 7
)bb7 8
{cc 
_loggerdd 
.dd 
Infodd 
(dd 
$strdd D
,ddD E
userIdddF L
)ddL M
;ddM N
	UserModelff 
?ff 
	userModelff 
=ff 
_userRepositoryff ,
.ff, -
GetUserByIdff- 8
(ff8 9
userIdff9 ?
)ff? @
;ff@ A
ifgg 
(gg	 

	userModelgg
 
==gg 
nullgg 
)gg 
{hh 
_loggerii 
.ii 
Errorii 
(ii 
$strii ;
,ii; <
userIdii= C
)iiC D
;iiD E
throwjj 
newjj 
CustomExceptionjj !
(jj! "
$numjj" %
,jj% &
$strjj' 2
,jj2 3
$strjj4 D
)jjD E
;jjE F
}kk 
Listmm 

<mm
 

EventIdDtomm 
>mm 
eventsmm 
=mm 
_eventRepositorymm  0
.mm0 1
GetEventsForUsermm1 A
(mmA B
userIdmmB H
)mmH I
;mmI J
_loggeroo 
.oo 
Infooo 
(oo 
$stroo X
,ooX Y
eventsooZ `
,oo` a
userIdoob h
)ooh i
;ooi j
returnqq 
eventsqq 
;qq 
}rr 
}ss 
}tt 